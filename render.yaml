databases:
  - name: fastapi-db
    databaseName: testdb
    user: postgres
    plan: free # Free tier: 1 GB storage, expires after 90 days
    ipAllowList: [] # Allow connections from any IP

services:
  - type: web
    name: fastapi-app
    runtime: python
    plan: free # Free tier: 512 MB RAM, spins down after 15 min inactivity
    buildCommand: 'pip install -r requirements.txt'
    startCommand: 'uvicorn app.main:app --host 0.0.0.0 --port $PORT'
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.0

      # Your app secrets
      - key: ALGORITHM
        value: HS256
      - key: SECRET_KEY
        value: supersecretkey
      - key: ACCESS_TOKEN_EXP_MINUTES
        value: 30

      # These will be linked to the Render database automatically
      - key: DB_USERNAME
        fromDatabase:
          name: fastapi-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: fastapi-db
          property: password
      - key: DB_HOSTNAME
        fromDatabase:
          name: fastapi-db
          property: host
      - key: DB_PORT
        fromDatabase:
          name: fastapi-db
          property: port
      - key: DB_NAME
        fromDatabase:
          name: fastapi-db
          property: database
